/*!
 *  Responsive TeamRaiser Tables - version 1.2
 *  Michael Gyarmathy, Web Development Intern, Blackbaud
 *  Description: a jQuery Plugin that converts TeamRaiser tables into a
 *               responsive <div> format
 */
;(function(f,d,a,h){var e="responsiveTeamRaiserTable",g={labels:["Participant","Milestones","Amount Raised","&nbsp"],order:["name","milestones","amount","donate"],tableType:"team",sort:"amount"};function c(j,i){this.element=j;this.options=f.extend({},g,i);this._defaults=g;this._name=e;if(this.options.labels.length!=4){console.error("responsiveTeamRaiserTable - four labels must be specified");}if(this.options.order.length!=4){console.error("responsiveTeamRaiserTable - invalid order");}else{f(this.options.order).each(function(){switch(String(this)){case"name":case"milestones":case"amount":case"donate":break;default:console.error('responsiveTeamRaiserTable - invalid order: "'+this+'" is not a valid column name. options are: "name", "milestones", "amount", or "donate"');break;}});}this.init();}c.prototype.init=function(){var n=this,i=[],m=[];if(n.options.tableType==="team"){f(n.element).find("tbody").find("tr").each(function(r,s){var u=f(s).find("td")[0].innerHTML;var t=f(s).find("td")[1].innerHTML;var q=b(f(s).find("a:first").attr("href"));if(q=="null"){return;}i.push({name:u.substring(3,u.length-2),amount_display:t.substring(0,t.length-3),amount:parseFloat(t.substring(1,t.length)),id:q});});}else{if(n.options.tableType==="S42"){var p=[],l=[],k=[],j=[],i=[];f(n.element).find("a").each(function(q,r){p.push(f(r).prop("outerHTML"));l.push(b(f(r).attr("href")));});f(n.element).contents().filter(function(){return this.nodeType==3&&this.nodeValue.indexOf("$")>0;}).wrap('<span class="amountRaised"></span>');f("span.amountRaised").each(function(r,s){var q=f(s).html();q=q.replace("&nbsp;","");q=q.replace("(","");q=q.replace(")","");q=q.substring(0,q.length-3);k.push(q);});f(n.element).prepend("</br>");f(n.element).find("br").each(function(){var q=f();var r=this.nextSibling;while(r){if(!f(r).is("br")){q.push(r);r=r.nextSibling;}else{break;}}q.wrapAll('<div class="old-tablerow" />');});f(".old-tablerow").each(function(q){j[q]="";f(this).find("img").each(function(){j[q]+=this.outerHTML;});});f(p).each(function(q){i.push({id:l[q],name:p[q],amount_display:k[q],amount:parseInt(k[q].substring(1,k[q].length)),badges:j[q]});});}}if(n.options.sort==="amount"){i.sort(function(r,q){return q.amount-r.amount;});}else{if(n.options.sort==="name"){i.sort(function(r,q){var s=r.name;nameB=q.name;s=s.replace(/<[a|A][^>]*>/g,"");nameB=nameB.replace(/<[a|A][^>]*>/g,"");s=s.replace(/<\/[a|A]>/g,"");nameB=nameB.replace(/<\/[a|A]>/g,"");s=s.replace(/<[img|IMG][^>]*>/g,"");nameB=nameB.replace(/<[img|IMG][^>]*>/g,"");s=s.replace(/^[ \t\n]+/g,"");nameB=nameB.replace(/^[ \t\n]+/g,"");return s.localeCompare(nameB);});}}f(n.element).before('<div id="teamRosterTable"></div>');var o="";f(n.options.order).each(function(q){switch(String(this)){case"name":o+='<div class="tableCell name"><div class="cellContent">'+n.options.labels[q]+"</div></div>";break;case"milestones":o+='<div class="tableCell milestones"><div class="cellContent">'+n.options.labels[q]+"</div></div>";break;case"amount":o+='<div class="tableCell amount"><div class="cellContent">'+n.options.labels[q]+"</div></div>";break;case"donate":o+='<div class="tableCell donate"><div class="cellContent">'+n.options.labels[q]+"</div></div>";break;default:break;}});f("#teamRosterTable").append('<div class="tableRow tableHeading">'+o+"</div>");f(i).each(function(s,q){var r="";f(n.options.order).each(function(){switch(String(this)){case"name":r+='<div class="tableCell name"><div class="cellContent">'+q.name+"</div></div>";break;case"milestones":r+='<div class="tableCell milestones"><div class="cellContent">'+(n.options.tableType==="S42"?q.badges:"")+"</div></div>";break;case"amount":r+='<div class="tableCell amount"><div class="cellContent">'+q.amount_display+"</div></div>";break;case"donate":r+='<div class="tableCell donate"><div class="cellContent"><a href="Donation2?df_id=[[S42:5910:form-id]]&FR_ID=[[S334:fr_id]]&PROXY_ID='+q.id+'&PROXY_TYPE=20&[[S42:5910:form-id]].donation=form1"><button>Donate</button></a></div></div>';break;default:break;}});f("#teamRosterTable").append('<div class="tableRow">'+r+"</div>");});if(n.options.tableType==="team"){f(".tableCell.name .cellContent img").each(function(r,q){f(q).parent().parent().parent().find(".tableCell.milestones .cellContent").append(f(q).clone());}).remove();f("td.tr_captain a").each(function(r,q){m.push(f(q).html());});f(m).each(function(r,q){f(".tableCell.name .cellContent a").each(function(s,t){if(t.innerHTML==q){f(t).parent().parent().parent().find(".tableCell.milestones .cellContent").prepend('<img src="img/yellow-star.png" title="Team Captain" />');return false;}});});}f(n.element).remove();};f.fn[e]=function(i){return this.each(function(){if(!f.data(this,"plugin_"+e)){f.data(this,"plugin_"+e,new c(this,i));}});};function b(j){if(j!==h){var l=j.split("?")[1];var m=l.split("&");for(var k=0;k<m.length;k++){var n=m[k].split("=");if(n[0]=="px"){return n[1];}}}return"null";}})(jQuery,window,document);